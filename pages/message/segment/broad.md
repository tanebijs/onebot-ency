# 广义消息段

广义消息段指在 QQ 客户端不以消息的形式出现，但仍然位于 OneBot 11 标准中的消息段。

## `poke`

指**私聊页面中的戳一戳**（最早名为**窗口抖动**），而非群聊和私聊中都存在的“小灰条”戳一戳。注意区分。

### 参数

| 参数名 | 类型   | 描述                       |
| ------ | ------ | -------------------------- |
| type   | number | 戳一戳类型                 |
| id     | number | 戳一戳 ID                  |
| name   | string | 戳一戳名称，仅在收到时有效 |

::: details Mirai 的 PokeMessage 类对戳一戳类型和 ID 的定义

| 戳一戳名称 | 类型 | ID   |
| ---------- | ---- | ---- |
| 戳一戳     | 1    | -1   |
| 比心       | 2    | -1   |
| 点赞       | 3    | -1   |
| 心碎       | 4    | -1   |
| 666        | 5    | -1   |
| 放大招     | 6    | -1   |
| 宝贝球     | 126  | 2011 |
| 玫瑰花     | 126  | 2007 |
| 召唤术     | 126  | 2006 |
| 让你皮     | 126  | 2009 |
| 结印       | 126  | 2005 |
| 手雷       | 126  | 2004 |
| 勾引       | 126  | 2003 |
| 抓一下     | 126  | 2001 |
| 碎屏       | 126  | 2002 |
| 敲门       | 126  | 2002 |

:::

### 说明

OneBot 11 设计时，还不存在上述第二种“小灰条”戳一戳，因此需要发送新的戳一戳时，需要用 `send_poke` 之类的扩展 API。

## `anonymous`

当消息中包含该消息段时，表示该消息是匿名发送的。NTQQ 已经不再支持匿名消息，因此该消息段已经过时。

## `forward`

表示合并转发消息。

### 参数

| 参数名 | 类型   | 描述                                                     |
| ------ | ------ | -------------------------------------------------------- |
| id     | string | 合并转发资源 ID，需通过 get_forward_msg API 获取具体内容 |

## `node`

表示合并转发消息节点，每个节点表示一条完整的转发消息。

### 参数

发送 `node` 时，有两种表示消息节点的方式：

其一是直接引用存在的消息，这时需要提供消息 ID，参数如下：

| 参数名 | 类型   | 描述    |
| ------ | ------ | ------- |
| id     | number | 消息 ID |

其二是自定义消息，这时需要提供消息内容，参数如下：

| 参数名   | 类型    | 描述             |
| -------- | ------- | ---------------- |
| user_id  | number  | 消息发送者 QQ 号 |
| nickname | string  | 消息发送者昵称   |
| content  | message | 消息内容         |

使用 `get_forward_msg` API 时，返回的消息是 `node` 消息段数组，且均为自定义消息风格的参数。

### 说明

在 [go-cqhttp](https://docs.go-cqhttp.org/cqcode/#%E5%90%88%E5%B9%B6%E8%BD%AC%E5%8F%91%E6%B6%88%E6%81%AF%E8%8A%82%E7%82%B9) 中，发送自定义消息 `node` 时所用的字段和 OneBot 11 标准中定义的**完全不同**，具体如下：

| 参数名  | 类型    | 描述             |
| ------- | ------- | ---------------- |
| uin     | number  | 消息发送者 QQ 号 |
| name    | string  | 消息发送者昵称   |
| content | message | 消息内容         |
| time    | number  | 消息发送时间戳   |
| seq     | number  | 消息序列号       |

其余协议端的实现中，则兼顾了 OneBot 11 标准和 go-cqhttp 的实现，用两种风格的字段都可以发送。
